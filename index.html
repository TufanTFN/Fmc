<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MD OFFICE PRO | ENTERPRISE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --primary: #4f46e5; --primary-hover: #4338ca;
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-800: #1e293b; --slate-900: #0f172a;
            --success: #10b981; --danger: #ef4444; --glass: rgba(255, 255, 255, 0.95);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); 
            margin: 0; min-height: 100vh; color: var(--slate-800);
        }

        /* --- AUTH STYLES --- */
        #authBox { 
            display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px;
        }
        .auth-card { 
            background: var(--glass); backdrop-filter: blur(10px); 
            padding: 40px; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            width: 100%; max-width: 420px; border: 1px solid white;
        }
        .auth-card h2 { font-weight: 700; font-size: 28px; margin-bottom: 8px; color: var(--slate-900); text-align: center; }
        .auth-card p { text-align: center; color: #64748b; margin-bottom: 30px; font-size: 14px; }

        /* --- INPUTS & BUTTONS --- */
        .input-group { margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: var(--slate-800); }
        input, select { 
            width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid #e2e8f0;
            background: white; font-size: 14px; transition: 0.2s; box-sizing: border-box;
        }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        
        button { 
            width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700;
            cursor: pointer; transition: 0.3s; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }

        /* --- DASHBOARD STYLES --- */
        .top-nav { 
            background: var(--glass); padding: 15px 30px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 100;
        }
        .brand { font-size: 20px; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
        .user-pill { background: var(--slate-100); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 8px; }

        .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 20px; padding: 30px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 24px; }

        /* --- TAB NAVIGATION --- */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { 
            background: white; border: 1px solid #e2e8f0; padding: 10px 20px; border-radius: 12px; 
            font-size: 14px; font-weight: 600; color: #64748b; cursor: pointer; white-space: nowrap; transition: 0.2s;
        }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2); }

        /* --- PRICING CARDS --- */
        .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 24px 0; }
        .price-card { 
            background: white; border: 1px solid #e2e8f0; padding: 24px; border-radius: 20px; text-align: center;
            transition: 0.3s; display: flex; flex-direction: column; justify-content: space-between;
        }
        .price-card.featured { border: 2px solid var(--primary); transform: scale(1.05); }
        .price-card h4 { margin: 0; font-size: 14px; text-transform: uppercase; color: #64748b; }
        .price-card h2 { margin: 15px 0; font-size: 24px; color: var(--slate-900); }
        
        .hidden { display: none !important; }

        /* --- APPLICANT ITEMS --- */
        .applicant-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 16px; border-radius: 12px; border: 1px solid #f1f5f9; margin-bottom: 12px; background: var(--slate-50);
        }

        @media (max-width: 768px) { .pricing-grid { grid-template-columns: 1fr; } .price-card.featured { transform: none; } }
    </style>
</head>
<body>

    <div id="trialBar" style="background:#4f46e5; color:white; padding:8px; text-align:center; font-weight:600; font-size:12px;" class="hidden"></div>

    <div id="authBox">
        <div class="auth-card" id="loginUI">
            <h2>Welcome Back</h2>
            <p>Enter your credentials to access your office.</p>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="logEmail" placeholder="name@company.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="logPass" placeholder="••••••••">
            </div>
            <button onclick="auth('login')" class="btn-primary" id="loginBtn">Sign In to Dashboard</button>
            <p style="margin-top:25px;">Don't have an office? <span onclick="toggleAuth(true)" style="color:var(--primary); cursor:pointer; font-weight:700;">Create one free</span></p>
        </div>

        <div class="auth-card hidden" id="signupUI">
            <h2>Get Started</h2>
            <p>Create your Managing Director account.</p>
            <div class="input-group">
                <label>Work Email</label>
                <input type="email" id="regEmail" placeholder="md@company.com">
            </div>
            <div class="input-group">
                <label>Secure Password</label>
                <input type="password" id="regPass" placeholder="••••••••">
            </div>
            <button onclick="mdSignup()" class="btn-primary" style="background:var(--success)">Create MD Account</button>
            <p style="margin-top:25px;">Already have an account? <span onclick="toggleAuth(false)" style="color:var(--primary); cursor:pointer; font-weight:700;">Sign in</span></p>
        </div>
    </div>

    <div id="appBox" class="hidden">
        <nav class="top-nav">
            <div class="brand"><i class="fa-solid fa-shield-halved"></i> MD OFFICE PRO</div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div class="user-pill" id="userTag"><i class="fa-solid fa-circle-user"></i> Loading...</div>
                <button onclick="location.reload()" style="width:auto; padding:8px 15px; background:var(--danger); color:white; font-size:12px;">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div id="devTab" class="hidden">
                <div class="card" style="border-left: 6px solid var(--dev);">
                    <h3 style="margin-top:0;"><i class="fa-solid fa-gears"></i> Developer Control</h3>
                    <button onclick="runTriggerInstall()" class="tab-btn" style="width:auto; margin-bottom:20px;">Sync System Automation</button>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                        <div class="card" style="margin:0; background:var(--slate-50);">
                            <h4>Active MDs</h4><p id="statMDs" style="font-size:32px; font-weight:800; color:var(--dev);">0</p>
                        </div>
                        <div class="card" style="margin:0; background:var(--slate-50);">
                            <h4>License Generator</h4>
                            <input type="number" id="keyDays" placeholder="Days" style="margin-bottom:10px;">
                            <button onclick="genKey()" class="btn-primary" style="background:var(--dev)">Create Key</button>
                            <div id="keyDisplay" style="margin-top:10px; font-weight:bold; color:var(--dev);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="mdNav" class="nav-tabs hidden">
                <div class="tab-btn active" onclick="switchTab('pipeTab', this)"><i class="fa-solid fa-list-check"></i> Pipeline</div>
                <div class="tab-btn" onclick="switchTab('staffTab', this)"><i class="fa-solid fa-users-gear"></i> Staff</div>
                <div class="tab-btn" onclick="switchTab('brandTab', this)"><i class="fa-solid fa-pen-nib"></i> Branding</div>
                <div class="tab-btn" onclick="switchTab('licTab', this)"><i class="fa-solid fa-crown"></i> License</div>
            </div>

            <div id="pipeTab" class="card hidden">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0;">Applicant Pipeline</h3>
                    <button onclick="exportToExcel()" style="width:auto; background:var(--slate-900); font-size:12px;"><i class="fa-solid fa-file-export"></i> Export CSV</button>
                </div>
                <div id="pipeBody">Loading pipeline data...</div>
            </div>

            <div id="brandTab" class="card hidden">
                <h3>Digital Assets</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                    <div><label>Company Logo</label><input type="file" id="logoFile"></div>
                    <div><label>MD Digital Signature</label><input type="file" id="signFile"></div>
                </div>
                <button onclick="uploadBranding()" class="btn-primary" style="margin-top:20px;"><i class="fa-solid fa-cloud-arrow-up"></i> Update Branding</button>
            </div>

            <div id="licTab" class="card hidden">
                <h2 align="center">Upgrade Your Office</h2>
                <div class="pricing-grid">
                    <div class="price-card"><h4>Weekly</h4><h2>₦5,000</h2><button onclick="buyPlan('Weekly')">Buy Now</button></div>
                    <div class="price-card featured"><h4>Monthly</h4><h2>₦15,000</h2><button class="btn-primary" onclick="buyPlan('Monthly')">Best Value</button></div>
                    <div class="price-card"><h4>Quarterly</h4><h2>₦40,000</h2><button onclick="buyPlan('3-Months')">Buy Now</button></div>
                    <div class="price-card"><h4>6-Months</h4><h2>₦75,000</h2><button onclick="buyPlan('6-Months')">Buy Now</button></div>
                    <div class="price-card"><h4>Yearly</h4><h2>₦120,000</h2><button onclick="buyPlan('Annual')">Buy Now</button></div>
                </div>
                <div class="card" style="background:var(--slate-50); border: 2px dashed #cbd5e1; margin-top:30px;">
                    <h4 style="margin-top:0;">Have an Activation Key?</h4>
                    <input type="text" id="licenseKey" placeholder="PRO-XXXX-XXXX" style="max-width:300px;">
                    <button onclick="activateLicense()" class="btn-primary" style="width:auto; display:inline-flex; padding:12px 30px; margin-left:10px;">Activate</button>
                </div>
            </div>

            <div id="entryTab" class="card hidden">
                <h3><i class="fa-solid fa-user-plus"></i> New Applicant Registration</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <input type="text" id="apName" placeholder="Full Name">
                    <input type="tel" id="apPhone" placeholder="Phone Number">
                    <input type="email" id="apEmail" placeholder="Email Address">
                    <input type="text" id="apCourse" placeholder="Course Applied For">
                    <select id="apQual">
                        <option value="SSCE">SSCE</option><option value="OND">OND</option><option value="HND">HND</option>
                        <option value="NCE">NCE</option><option value="B.Sc">B.Sc</option><option value="B.A">B.A</option>
                        <option value="LL.B">LL.B</option><option value="MBBS">MBBS</option><option value="M.Sc">M.Sc</option>
                        <option value="MBA">MBA</option><option value="Ph.D">Ph.D</option>
                    </select>
                    <select id="apGrade">
                        <option>First Class / Distinction</option><option>Second Upper</option><option>Second Lower</option><option>Third Class / Pass</option>
                    </select>
                </div>
                <button onclick="submitApp()" class="btn-primary" style="margin-top:20px; background:var(--success)">Register Applicant</button>
            </div>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbzjzqjcxrR5TdrcW8YX9_WcUKvCECohDgZjIWh8vayDWH7QHUNppZr4usDzfxLn5lcllw/exec"; 
        let user = {};

        async function auth(action) {
            const btn = document.getElementById('loginBtn'); btn.innerText = "Processing...";
            const res = await fetch(API, {method:'POST', body:JSON.stringify({action, email:document.getElementById('logEmail').value, password:document.getElementById('logPass').value})});
            const data = await res.json();
            if(data.success) {
                user = data; document.getElementById('authBox').classList.add('hidden'); document.getElementById('appBox').classList.remove('hidden');
                document.getElementById('userTag').innerHTML = `<i class="fa-solid fa-circle-user"></i> ${user.email}`;
                if(user.role === 'DEV') { document.getElementById('devTab').classList.remove('hidden'); refreshAdmin(); }
                else if(user.isExpired) { show('licTab'); }
                else if(user.role === 'MD') { document.getElementById('mdNav').classList.remove('hidden'); show('pipeTab'); loadPipeline(); }
                else show('entryTab');
                if(user.hoursLeft > 0) { document.getElementById('trialBar').classList.remove('hidden'); document.getElementById('trialBar').innerText = `TRIAL ACCOUNT EXPIRES IN ${user.hoursLeft} HOURS`; }
            } else { alert("Access Denied"); btn.innerText = "Sign In to Dashboard"; }
        }

        async function loadPipeline() {
            const res = await fetch(API); const d = await res.json();
            const mine = d.filter(r => r[8] === user.email);
            document.getElementById('pipeBody').innerHTML = mine.length ? mine.map(r => `
                <div class="applicant-item">
                    <div>
                        <div style="font-weight:700;">${r[0]}</div>
                        <div style="font-size:12px; color:#64748b;">${r[3]} • ${r[9]}</div>
                    </div>
                    <div>
                        ${r[5]==='Pending'? `<button onclick="approve('${r[0]}','${r[2]}','${r[3]}','${r[9]}','${r[4]}')" style="background:var(--success); font-size:11px; width:auto; padding:6px 12px;">Approve Letter</button>` : `<span style="color:var(--success); font-weight:700; font-size:12px;"><i class="fa-solid fa-check-double"></i> ${r[5]}</span>`}
                    </div>
                </div>`).join('') : '<p align="center" style="color:#64748b;">No applicants found yet.</p>';
        }

        async function buyPlan(p) {
            fetch(API, {method:'POST', body:JSON.stringify({action:'log_interest', email:user.email, plan:p})});
            window.open(`https://wa.me/2347030151024?text=Hello, I want to activate the ${p} plan for ${user.email}`, '_blank');
        }

        async function uploadBranding() {
            const toB64 = f => new Promise(r => { const rd = new FileReader(); rd.readAsDataURL(f); rd.onload = () => r(rd.result); }); 
            const logo = document.getElementById('logoFile').files[0] ? await toB64(document.getElementById('logoFile').files[0]) : null;
            const sign = document.getElementById('signFile').files[0] ? await toB64(document.getElementById('signFile').files[0]) : null;
            await fetch(API, {method:'POST', body:JSON.stringify({action:'update_branding', email:user.email, logo, sign})}); alert("Branding Updated!"); 
        }

        async function activateLicense() { const res = await fetch(API, {method:'POST', body:JSON.stringify({action:'redeem_key', email:user.email, key:document.getElementById('licenseKey').value})}); alert(await res.text()); location.reload(); }
        async function submitApp() { await fetch(API, {method:'POST', body:JSON.stringify({action:'submit_applicant', name:document.getElementById('apName').value, phone:document.getElementById('apPhone').value, email:document.getElementById('apEmail').value, course:document.getElementById('apCourse').value, qual:document.getElementById('apQual').value, grade:document.getElementById('apGrade').value, submittedBy:user.email, mdEmail:user.mdEmail})}); alert("Applicant Successfully Registered!"); }
        async function mdSignup() { await fetch(API, {method:'POST', body:JSON.stringify({action:'md_signup', email:document.getElementById('regEmail').value, password:document.getElementById('regPass').value})}); alert("Success! Your 24-hour trial starts now."); toggleAuth(false); }
        async function genKey() { const res = await fetch(API, {method:'POST', body:JSON.stringify({action:'generate_key', email:user.email, days:document.getElementById('keyDays').value})}); document.getElementById('keyDisplay').innerText = `KEY: ${await res.text()}`; }
        function show(id) { ['pipeTab','brandTab','licTab','entryTab','devTab'].forEach(t => document.getElementById(t).classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
        function switchTab(id, el) { show(id); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
        function toggleAuth(s) { document.getElementById('loginUI').classList.toggle('hidden', s); document.getElementById('signupUI').classList.toggle('hidden', !s); }
        async function runTriggerInstall() { const res = await fetch(API, {method:'POST', body:JSON.stringify({action:'install_trigger', email:user.email})}); alert(await res.text()); }
        function exportToExcel() { fetch(API).then(r => r.json()).then(data => { const mine = data.filter(r => r[8] === user.email); let csv = "Name,Phone,Email,Qual,Grade,Status,Date,Course\n"; mine.forEach(r => csv += `"${r[0]}","${r[1]}","${r[2]}","${r[3]}","${r[4]}","${r[5]}","${r[6]}","${r[9]}"\n`); const link = document.createElement("a"); link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv); link.download = 'Applicant_Report.csv'; link.click(); }); }
    </script>
</body>
</html>